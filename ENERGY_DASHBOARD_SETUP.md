# Setting Up Home Assistant Energy Dashboard with SolArk

## Overview

With version 5.0.0+, the SolArk Cloud integration is fully compatible with Home Assistant's Energy dashboard. You can track solar production, grid consumption, battery usage, and home consumption all in one place.

## What Gets Tracked

The Energy dashboard can track:
- âœ… **Solar Production** - Energy generated by your panels
- âœ… **Grid Consumption** - Energy imported from the grid
- âœ… **Grid Return** - Energy exported to the grid  
- âœ… **Home Consumption** - Total energy used by your home
- âœ… **Battery** - Energy charged and discharged

## Prerequisites

1. **Integration installed** - SolArk Cloud integration v5.0.0 or newer
2. **Sensors working** - Verify sensors show data in Developer Tools â†’ States
3. **Energy dashboard enabled** - Home Assistant 2021.8.0 or newer (Energy dashboard is built-in)

## Step-by-Step Setup

### Step 1: Access Energy Dashboard Configuration

1. Go to **Settings** â†’ **Dashboards** â†’ **Energy**
2. Or click **Energy** in the sidebar (if visible)
3. Click **Add Energy Configuration** (first time) or the **gear icon** (if already configured)

### Step 2: Configure Solar Production

1. In the Energy Configuration, find **Solar panels**
2. Click **ADD SOLAR PRODUCTION**
3. Select: `sensor.solark_energy_total`
4. Click **SAVE**

**Why this sensor?**
- `sensor.solark_energy_total` is a cumulative counter (TOTAL_INCREASING)
- Home Assistant calculates daily/monthly production from this
- This tracks your total lifetime solar production

### Step 3: Configure Grid Consumption and Return

The integration provides native energy sensors for grid import/export using a
trapezoidal (Riemann) integration of the power sensors.

1. Under **Grid consumption**, click **ADD CONSUMPTION**
2. Select **Energy consumed from the grid**: `sensor.solark_grid_import_energy`
3. Under **Grid production** (if you export):
   - Click **ADD RETURN**
   - Select `sensor.solark_grid_export_energy`
4. Click **SAVE**

### Step 4: Configure Home Battery (Optional)

The integration provides battery charge/discharge energy sensors directly:

- `sensor.solark_battery_charge_energy`
- `sensor.solark_battery_discharge_energy`

In Energy Configuration:

1. Under **Battery systems**, click **ADD BATTERY SYSTEM**
2. **Energy going in**: select `sensor.solark_battery_charge_energy`
3. **Energy going out**: select `sensor.solark_battery_discharge_energy`
4. Click **SAVE**

### Step 5: Verify Configuration

1. Wait 1-2 hours for data to accumulate
2. Go to **Energy** dashboard
3. You should see:
   - Solar production graph
   - Grid consumption/export
   - Home consumption (if configured)

## Troubleshooting

### "Sensor not available" in Energy Dashboard

**Cause:** Energy dashboard only accepts sensors with `state_class: TOTAL_INCREASING` or `TOTAL` for cumulative counters.

**Solution:** 
- Use `sensor.solark_energy_total` for solar (it has the correct state_class)
- Use `sensor.solark_grid_import_energy` and `sensor.solark_grid_export_energy` for grid

### "Statistics not available"

**Cause:** New sensors need time to build up statistics (usually 1-2 hours).

**Solution:** Wait and check back later. Home Assistant builds statistics in the background.

### Graphs Show Flat Lines

**Cause:** No data variation yet, or sensor not updating.

**Solutions:**
1. Verify sensor updates: Developer Tools â†’ States â†’ Check sensor timestamps
2. Wait for solar production (during daylight hours)
3. Check integration is working: Settings â†’ Devices & Services â†’ SolArk Cloud

### Energy Values Seem Wrong

**Causes:**
- Energy sensors created recently (they start from zero)
- Integration was offline/unavailable during periods
- Power sensor reporting incorrect values

**Solutions:**
1. Give it 24 hours to accumulate accurate data
2. Check power sensors show reasonable values
3. Verify integration scan interval isn't too slow (30s recommended)

### Reset Energy Statistics

If you need to start fresh:

1. Go to **Developer Tools** â†’ **Statistics**
2. Find your energy sensors
3. Click **Fix Issue** â†’ **Delete All Statistics**
4. Confirm deletion
5. Statistics will rebuild from current time forward

## What You Can Do with Energy Dashboard

Once configured, you can:

- âœ… Track daily/monthly/yearly solar production
- âœ… Monitor grid import vs export
- âœ… Calculate self-consumption percentage
- âœ… View energy flow diagrams
- âœ… Track costs (if you add electricity rates)
- âœ… Compare time periods
- âœ… Export data for analysis

## Adding Electricity Costs (Optional)

To track costs:

1. Go to Energy Configuration
2. Under **Grid consumption**, click the **pencil icon** next to your grid sensor
3. Check **Use an entity tracking the total costs**
4. You can either:
   - Enter a **fixed price per kWh**
   - Or select a **sensor** that tracks your electricity rate

Home Assistant will then show cost calculations in the Energy dashboard.

## Energy Dashboard vs. Your Custom Dashboard

**Energy Dashboard** (Settings â†’ Dashboards â†’ Energy):
- Built into Home Assistant
- Automatic graphs and statistics
- Shows cumulative energy over time (kWh)
- Best for long-term tracking and cost analysis

**Your SolArk Custom Dashboard** (`dashboards/solark_flow.yaml`):
- Real-time power monitoring (W)
- Instant power flow visualization
- Live status indicators
- Best for moment-to-moment monitoring

**Use Both!** They complement each other:
- Custom dashboard for "What's happening right now?"
- Energy dashboard for "How much energy this month?"

## Example Complete Configuration

Use these sensors directly in the Energy dashboard:
- **Solar**: sensor.solark_energy_total
- **Grid Import**: sensor.solark_grid_import_energy
- **Grid Export**: sensor.solark_grid_export_energy
- **Battery In**: sensor.solark_battery_charge_energy
- **Battery Out**: sensor.solark_battery_discharge_energy

## Summary

Your SolArk Cloud integration is now fully Energy dashboard compatible! The key requirements are:

1. âœ… Energy sensors have `state_class: TOTAL_INCREASING` (done in v5.0.0+)
2. âœ… Power sensors have `state_class: MEASUREMENT` (done in v5.0.0+)
3. âœ… Grid and battery energy sensors are provided by the integration
4. âœ… Configure Energy dashboard with your sensors

After setup, you'll have comprehensive energy tracking showing exactly where your energy comes from and goes to! ðŸŒžðŸ”‹âš¡
